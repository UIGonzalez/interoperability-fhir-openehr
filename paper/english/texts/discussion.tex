\section{Discussion}

Exchanging data is one of the most basic requirements openEHR seeks to fulfill. Importing and exporting data through FHIR interfaces over openEHR repositories requires data conversion. Technically, there are 2 issues to solve, being equivalence on a structure level and compatibility on a data type level.

The present work solves the structural equivalence creating integration archetypes similar to that exposed in \cite{openEHRArchitecture}. These archetypes created are characterized by:

\begin{enumerate}
  \item being based on CLUSTER and ELEMENT classes;
  \item being designed to copy the data structure of existing FHIR resources;
  \item existence of an integration archetype per shared FHIR resource.
\end{enumerate}

Given that the structures of these integration archetypes are identical to the structures of FHIR resources used to exchange data, ADL paths of the integration archetypes and resource element paths can be used to establish rules of data conversion. These conversion rules can be used in transformation programs based on XQuery to convert FHIR resource instances into instances of openEHR integration archetypes and vice-versa. These integration archetypes can be used by openEHR software or mapped to existing archetypes using tools like LinkEHR-Ed \cite{Maldonado09}. This mapping remains as future work and is a part of the integration strategy based on archetypes as stated in \cite{openEHRIntegration}.

An advantage of archetype based integration is that integration archetype design is performed by IT or other technical personnel familiar with incoming data structures, without envolving domain specialists. This is important for it delegates system integration responsibilities to IT personnel, while keeping domain specialists in charge of the design of the remaining archetypes.

In this integration strategy we have the disadvantage of having to create integration archetypes instead of directly using archetypes available in libraries. Nevertheless, this problem can be solved making direct transformations between integration archetypes and those designed in libraries. Using the same FHIR space name for the integration archetypes will work to distinguish these archetypes that represent FHIR resources.

A problem to solve is the recursive definition of FHIR resources that is not allowed in openEHR archetypes. A way to solve this is by restricting the recursiveness depth. Other ways to solve this require future work.

In a way to resolve compatibility between FHIR and openEHR data types, a definition of equivalence was proposed, with 2 conditions. First condition ensures that all FHIR data can be converted into openEHR data. Second condition ensures that converted data can be processed properly.

A way to solve the particular case concerning equivalence between String and DV\_TEXT types is that in data conversion of these non printed characters they be replaced by their Unicode codification so that they can be stored as text within DV\_TEXT type and when retrieved they be turned back to their original value. This way it is guaranteed there wonâ€™t be any information loss.

Medicine is a changing domain. Therefore, providing an automatic creation process of integration archetypes that saves time and reduces mistakes has great utility for technical personnel. The experiment performed showed significant reduction in creation time using the automated process.

In conclusion, equivalences in types and the automated process helps to convert and process FHIR resource instance data into openEHR integration archetype instances properly, this being a step to verify the possibility of creating FHIR resources out of openEHR archetypes using the presented equivalences and the process proposed in the work.
