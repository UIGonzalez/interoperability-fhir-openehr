\subsubsection{Etapa de sustitución}

Un esquema basado en tipos de datos FHIR generado en la etapa previa se transforma en un esquema basado en tipos de datos openEHR. La transformación es directa. Cada definición de un tipo de dato FHIR se reemplaza por una definición de tipo de dato openEHR equivalente. Cada definición de vinculación sobre un tipo de dato FHIR se sustituye por una definición de vinculación sobre un tipo de dato openEHR equivalente.

Por ejemplo, el esquema FHIR del recurso SimplePatient se transforma al reemplazar la definición del tipo FHIR code por la definición del tipo openEHR DV\_TEXT equivalente en:

\begin{align*}
&T_{SimplePatient}:= \\
&\qquad es\_SimplePatient\{T_{SimplePatient.gender}^{(0:1)}\} \\
&T_{SimplePatient.gender}:= \\
&\qquad es\_gender\{T_{SimplePatient.gender.DV\_TEXT}^{(1:1)}\} \\
&T_{SimplePatient.gender.DV\_TEXT}:= \\
&\qquad es\_DV\_TEXT\{T_{SimplePatient.gender.DV\_TEXT.value}^{(1:1)}\} \\
&T_{SimplePatient.gender.DV\_TEXT.value}:= \\
&\qquad es\_value\{T_{string}^{(1:1)}\} \\
&[T_{SimplePatient.gender.DV\_TEXT.value}] := \\
& http://hl7.org/ValueSet/administrative-gender \\
&T_{string}:= \\
&\qquad es\_string\{\epsilon\} \\
\end{align*}

A un esquema basado en tipos de datos openEHR se le denomina esquema openEHR en este trabajo. Como se observa, los esquemas FHIR y openEHR de SimplePatient conservan la misma estructura que la definida por el recurso SimplePatient.
